
{% extends "base.html" %}

{% block title %}Ø§Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø± - ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¯Ø±ÙˆØ³ Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h2><i class="fas fa-video"></i> Ø§Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</h2>
        <p class="text-muted">Ø£Ø¯Ø± Ø¬Ù„Ø³Ø§Øª ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ø¹ Ø§Ù„Ø·Ù„Ø§Ø¨</p>
    </div>
</div>

<div class="row">
    <div class="col-lg-8">
        <div class="card mb-4">
            <div class="card-header bg-danger text-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0"><i class="fas fa-broadcast-tower"></i> Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©</h5>
                <span class="badge bg-light text-dark" id="sessionStatus">ØºÙŠØ± Ù†Ø´Ø·Ø©</span>
            </div>
            <div class="video-container">
                <div class="text-center d-flex align-items-center justify-content-center" 
                     style="height: 400px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    <div class="text-white">
                        <i class="fas fa-video fa-4x mb-3"></i>
                        <h4>Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ØºÙŠØ± Ù†Ø´Ø·Ø©</h4>
                        <p>Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ "Ø¨Ø¯Ø¡ Ø§Ù„Ø¨Ø«" Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø©</p>
                    </div>
                </div>
                <div class="video-controls">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <button class="btn btn-success" id="startStreamBtn" onclick="startLiveSession()">
                                <i class="fas fa-play"></i> Ø¨Ø¯Ø¡ Ø§Ù„Ø¨Ø«
                            </button>
                            <button class="btn btn-danger" id="endStreamBtn" style="display: none;" onclick="endLiveSession()">
                                <i class="fas fa-stop"></i> Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¨Ø«
                            </button>
                        </div>
                        <div>
                            <button class="btn btn-outline-light btn-sm" onclick="toggleMic()">
                                <i class="fas fa-microphone" id="micIcon"></i>
                            </button>
                            <button class="btn btn-outline-light btn-sm" onclick="toggleCamera()">
                                <i class="fas fa-video" id="cameraIcon"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
                <h6 class="mb-0"><i class="fas fa-chalkboard"></i> Ø§Ù„Ø³Ø¨ÙˆØ±Ø© Ø§Ù„Ø°ÙƒÙŠØ©</h6>
                <div>
                    <button class="btn btn-light btn-sm" onclick="liveSession.clearWhiteboard()">
                        <i class="fas fa-eraser"></i> Ù…Ø³Ø­
                    </button>
                    <select class="btn btn-light btn-sm" id="penColor">
                        <option value="#000">Ø£Ø³ÙˆØ¯</option>
                        <option value="#f00">Ø£Ø­Ù…Ø±</option>
                        <option value="#00f">Ø£Ø²Ø±Ù‚</option>
                        <option value="#0f0">Ø£Ø®Ø¶Ø±</option>
                    </select>
                </div>
            </div>
            <div class="card-body p-0">
                <canvas id="whiteboard" width="800" height="400" class="whiteboard w-100"></canvas>
            </div>
        </div>
    </div>
    
    <div class="col-lg-4">
        <div class="card mb-3">
            <div class="card-header bg-success text-white">
                <h6><i class="fas fa-users"></i> Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙˆÙ† (<span id="participantCount">0</span>)</h6>
            </div>
            <div class="card-body" style="max-height: 200px; overflow-y: auto;">
                <div id="participantsList">
                    <p class="text-muted text-center">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙƒÙˆÙ† Ø­Ø§Ù„ÙŠØ§Ù‹</p>
                </div>
            </div>
        </div>
        
        <div class="card mb-3">
            <div class="card-header bg-warning text-white">
                <h6><i class="fas fa-cog"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¬Ù„Ø³Ø©</h6>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label class="form-label">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¬Ù„Ø³Ø©</label>
                    <input type="text" class="form-control" id="sessionTitle" value="Ø¯Ø±Ø³ ÙÙŠ Ø§Ù„ÙÙ‚Ù‡">
                </div>
                <div class="mb-3">
                    <label class="form-label">ÙˆØµÙ Ø§Ù„Ø¬Ù„Ø³Ø©</label>
                    <textarea class="form-control" id="sessionDescription" rows="3">Ø¯Ø±Ø³ Ù…Ø¨Ø§Ø´Ø± Ø¹Ù† Ø£Ø­ÙƒØ§Ù… Ø§Ù„ØµÙ„Ø§Ø©</textarea>
                </div>
                <button class="btn btn-warning btn-sm w-100" onclick="saveSessionSettings()">
                    <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                </button>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header bg-dark text-white">
                <h6><i class="fas fa-comment-dots"></i> Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©</h6>
            </div>
            <div class="chat-container" style="height: 250px;" id="liveChatMessages">
                <!-- Live chat messages -->
            </div>
            <div class="card-footer">
                <div class="input-group input-group-sm">
                    <input type="text" class="form-control" id="liveChatInput" placeholder="Ø±Ø³Ø§Ù„Ø© Ø³Ø±ÙŠØ¹Ø©..." 
                           onkeypress="if(event.key==='Enter') sendLiveMessage()">
                    <button class="btn btn-primary" onclick="sendLiveMessage()">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
let sessionActive = false;
let micMuted = false;
let cameraOff = false;

function startLiveSession() {
    sessionActive = true;
    document.getElementById('sessionStatus').textContent = 'Ù†Ø´Ø·Ø©';
    document.getElementById('sessionStatus').className = 'badge bg-success text-white';
    document.getElementById('startStreamBtn').style.display = 'none';
    document.getElementById('endStreamBtn').style.display = 'inline-block';
    
    liveSession.startSession();
    updateParticipants();
    
    // Simulate video stream
    const videoContainer = document.querySelector('.video-container > div');
    videoContainer.innerHTML = `
        <div style="height: 400px; background: #000; position: relative; display: flex; align-items: center; justify-content: center;">
            <div class="text-white text-center">
                <i class="fas fa-video fa-3x mb-3"></i>
                <h5>Ø§Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù†Ø´Ø·</h5>
                <p>Ø§Ù„Ø¢Ù† ÙŠÙ…ÙƒÙ† Ù„Ù„Ø·Ù„Ø§Ø¨ Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ø¯Ø±Ø³</p>
            </div>
            <div class="position-absolute top-0 start-0 m-3">
                <span class="badge bg-danger">ğŸ”´ Ù…Ø¨Ø§Ø´Ø±</span>
            </div>
        </div>
    `;
}

function endLiveSession() {
    sessionActive = false;
    document.getElementById('sessionStatus').textContent = 'ØºÙŠØ± Ù†Ø´Ø·Ø©';
    document.getElementById('sessionStatus').className = 'badge bg-light text-dark';
    document.getElementById('startStreamBtn').style.display = 'inline-block';
    document.getElementById('endStreamBtn').style.display = 'none';
    
    liveSession.endSession();
    document.getElementById('participantCount').textContent = '0';
    document.getElementById('participantsList').innerHTML = '<p class="text-muted text-center">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙƒÙˆÙ† Ø­Ø§Ù„ÙŠØ§Ù‹</p>';
}

function toggleMic() {
    micMuted = !micMuted;
    const icon = document.getElementById('micIcon');
    icon.className = micMuted ? 'fas fa-microphone-slash' : 'fas fa-microphone';
    showNotification(micMuted ? 'ØªÙ… ÙƒØªÙ… Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†' : 'ØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†', 'info');
}

function toggleCamera() {
    cameraOff = !cameraOff;
    const icon = document.getElementById('cameraIcon');
    icon.className = cameraOff ? 'fas fa-video-slash' : 'fas fa-video';
    showNotification(cameraOff ? 'ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§' : 'ØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§', 'info');
}

function updateParticipants() {
    if (!sessionActive) return;
    
    const participants = [
        { name: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯', type: 'student' },
        { name: 'ÙØ§Ø·Ù…Ø© Ø¹Ù„ÙŠ', type: 'student' },
        { name: 'Ù…Ø­Ù…Ø¯ ØµØ§Ù„Ø­', type: 'student' },
        { name: '{{ session.username }}', type: '{{ session.user_type }}' }
    ];
    
    const count = participants.length;
    document.getElementById('participantCount').textContent = count;
    
    const list = document.getElementById('participantsList');
    list.innerHTML = participants.map(p => `
        <div class="d-flex justify-content-between align-items-center mb-2">
            <span>
                <i class="fas ${p.type === 'student' ? 'fa-user' : 'fa-user-tie'}"></i>
                ${p.name}
            </span>
            <span class="badge bg-success rounded-pill">Ù…ØªØµÙ„</span>
        </div>
    `).join('');
}

function saveSessionSettings() {
    showNotification('ØªÙ… Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¬Ù„Ø³Ø©', 'success');
}

function sendLiveMessage() {
    const input = document.getElementById('liveChatInput');
    const message = input.value.trim();
    
    if (message === '') return;
    
    const messageDiv = document.createElement('div');
    messageDiv.className = 'message sent';
    messageDiv.innerHTML = `
        <div class="message-header">
            <strong>Ø£Ù†Øª</strong>
            <small class="text-muted">${new Date().toLocaleTimeString('ar-SA')}</small>
        </div>
        <div class="message-text">${message}</div>
    `;
    
    document.getElementById('liveChatMessages').appendChild(messageDiv);
    input.value = '';
    
    // Scroll to bottom
    const container = document.getElementById('liveChatMessages');
    container.scrollTop = container.scrollHeight;
}
</script>
{% endblock %}
