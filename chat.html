
{% extends "base.html" %}

{% block title %}ุงููุญุงุฏุซุฉ - ุชุทุจูู ุงูุฏุฑูุณ ุงูุฅุณูุงููุฉ{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h2><i class="fas fa-comments"></i> ุงููุญุงุฏุซุฉ</h2>
        <p class="text-muted">ุชูุงุตู ูุน ุงูุฃุณุงุชุฐุฉ ูุงูุทูุงุจ ุงูุขุฎุฑูู</p>
    </div>
</div>

<div class="row">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0"><i class="fas fa-users"></i> ุงูุบุฑูุฉ ุงูุนุงูุฉ</h5>
                <span class="badge bg-light text-dark">
                    <span id="onlineCount">5</span> ูุชุตู
                </span>
            </div>
            <div class="chat-container" id="chatMessages">
                <div class="message received">
                    <div class="message-header">
                        <strong>ุงูุฃุณุชุงุฐ ูุนุชุตู</strong>
                        <small class="text-muted">10:30 ุต</small>
                    </div>
                    <div class="message-text">ูุฑุญุจุงู ุจูู ุฌููุนุงู ูู ุงูุบุฑูุฉ ุงูุนุงูุฉ</div>
                </div>
                <div class="message teacher">
                    <div class="message-header">
                        <strong>ุงูุฃุณุชุงุฐ ุฃุญูุฏ</strong>
                        <small class="text-muted">10:35 ุต</small>
                    </div>
                    <div class="message-text">ูุง ุชูุณูุง ูุฑุงุฌุนุฉ ุฏุฑุณ ุงูููู</div>
                </div>
            </div>
            <div class="card-footer">
                <div class="input-group">
                    <input type="text" class="form-control" id="messageInput" placeholder="ุงูุชุจ ุฑุณุงูุชู ููุง..." 
                           onkeypress="if(event.key==='Enter') sendMessage()">
                    <button class="btn btn-primary" onclick="sendMessage()">
                        <i class="fas fa-paper-plane"></i> ุฅุฑุณุงู
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-4">
        <div class="card mb-3">
            <div class="card-header bg-info text-white">
                <h6><i class="fas fa-users"></i> ุงููุชุตููู ุงูุขู</h6>
            </div>
            <div class="card-body">
                <div class="list-group list-group-flush">
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        <span><i class="fas fa-crown text-warning"></i> ุงูุฃุณุชุงุฐ ูุนุชุตู</span>
                        <span class="badge bg-success rounded-pill">ูุชุตู</span>
                    </div>
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        <span><i class="fas fa-user-tie text-primary"></i> ุงูุฃุณุชุงุฐ ุฃุญูุฏ</span>
                        <span class="badge bg-success rounded-pill">ูุชุตู</span>
                    </div>
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        <span><i class="fas fa-user text-secondary"></i> ุฃุญูุฏ ูุญูุฏ</span>
                        <span class="badge bg-success rounded-pill">ูุชุตู</span>
                    </div>
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        <span><i class="fas fa-user text-secondary"></i> ูุงุทูุฉ ุนูู</span>
                        <span class="badge bg-warning rounded-pill">ุบุงุฆุจ</span>
                    </div>
                </div>
            </div>
        </div>
        
        {% if session.user_type in ['developer', 'main_teacher', 'teacher'] %}
        <div class="card">
            <div class="card-header bg-warning text-white">
                <h6><i class="fas fa-tools"></i> ุฃุฏูุงุช ุงูุฃุณุชุงุฐ</h6>
            </div>
            <div class="card-body">
                <button class="btn btn-danger btn-sm w-100 mb-2" onclick="sendAnnouncement()">
                    <i class="fas fa-bullhorn"></i> ุฅุนูุงู ููุฌููุน
                </button>
                <button class="btn btn-warning btn-sm w-100 mb-2" onclick="clearChat()">
                    <i class="fas fa-trash"></i> ูุณุญ ุงูุฏุฑุฏุดุฉ
                </button>
                <button class="btn btn-info btn-sm w-100" onclick="muteStudent()">
                    <i class="fas fa-volume-mute"></i> ูุชู ุทุงูุจ
                </button>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<!-- Announcement Modal -->
<div class="modal fade" id="announcementModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">ุฅุฑุณุงู ุฅุนูุงู</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <textarea class="form-control" id="announcementText" rows="4" placeholder="ุงูุชุจ ุงูุฅุนูุงู ููุง..."></textarea>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ุฅูุบุงุก</button>
                <button type="button" class="btn btn-danger" onclick="publishAnnouncement()">
                    <i class="fas fa-bullhorn"></i> ูุดุฑ ุงูุฅุนูุงู
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function sendMessage() {
    const input = document.getElementById('messageInput');
    const message = input.value.trim();
    
    if (message === '') return;
    
    chatSystem.sendMessage(message, '{{ session.user_type }}');
    input.value = '';
}

function sendAnnouncement() {
    $('#announcementModal').modal('show');
}

function publishAnnouncement() {
    const text = document.getElementById('announcementText').value.trim();
    if (text === '') return;
    
    const announcementMessage = {
        id: Date.now(),
        text: `๐ข ุฅุนูุงู: ${text}`,
        sender: '{{ session.username }}',
        timestamp: new Date(),
        type: 'announcement'
    };
    
    chatSystem.displayMessage(announcementMessage);
    $('#announcementModal').modal('hide');
    document.getElementById('announcementText').value = '';
    showNotification('ุชู ูุดุฑ ุงูุฅุนูุงู', 'success');
}

function clearChat() {
    if (confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ูุณุญ ุฌููุน ุงูุฑุณุงุฆูุ')) {
        document.getElementById('chatMessages').innerHTML = '';
        showNotification('ุชู ูุณุญ ุงููุญุงุฏุซุฉ', 'info');
    }
}

function muteStudent() {
    showNotification('ุชู ูุชู ุงูุทุงูุจ', 'warning');
}

// Update online count periodically
setInterval(() => {
    const count = Math.floor(Math.random() * 3) + 3;
    document.getElementById('onlineCount').textContent = count;
}, 10000);
</script>
{% endblock %}
